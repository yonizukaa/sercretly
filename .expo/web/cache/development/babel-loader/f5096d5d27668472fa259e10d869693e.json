{"ast":null,"code":"import _defineProperty from \"@babel/runtime/helpers/defineProperty\";\n\nfunction ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); enumerableOnly && (symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; })), keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = null != arguments[i] ? arguments[i] : {}; i % 2 ? ownKeys(Object(source), !0).forEach(function (key) { _defineProperty(target, key, source[key]); }) : Object.getOwnPropertyDescriptors ? Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)) : ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } return target; }\n\nimport { collection, doc, onSnapshot, query, QuerySnapshot, where } from \"@firebase/firestore\";\nimport View from \"react-native-web/dist/exports/View\";\nimport Text from \"react-native-web/dist/exports/Text\";\nimport React, { useContext, useEffect } from \"react\";\nimport { auth, db } from \"../firebase\";\nimport GlobalContext from \"../context/Context\";\nimport ContactsFloatingIcons from \"../components/ContactsFloatingIcons\";\nimport ListItem from \"../components/ListItem\";\nimport useContacts from \"../hooks/useHooks\";\nexport default function Chats() {\n  var currentUser = auth.currentUser;\n\n  var _useContext = useContext(GlobalContext),\n      rooms = _useContext.rooms,\n      setRooms = _useContext.setRooms,\n      setUnfilteredRooms = _useContext.setUnfilteredRooms;\n\n  var contacts = useContacts();\n  var chatsQuery = query(collection(db, \"rooms\"), where(\"participantsArray\", \"array-contains\", currentUser.email));\n  useEffect(function () {\n    var unsubscribe = onSnapshot(chatsQuery, function (QuerySnapshot) {\n      var parsedChats = QuerySnapshot.docs.map(function (doc) {\n        return _objectSpread(_objectSpread({}, doc.data()), {}, {\n          id: doc.id,\n          userB: doc.data().participants.find(function (p) {\n            return p.email == !currentUser.email;\n          })\n        });\n      });\n      setUnfilteredRooms(parsedChats);\n      setRooms(parsedChats.filter(function (doc) {\n        return doc.data().lastMessage;\n      }));\n    });\n    return function () {\n      return unsubscribe();\n    };\n  }, []);\n\n  function getUserB(user, contacts) {\n    var userContact = contacts.find(function (c) {\n      return c.email === user.email;\n    });\n\n    if (userContact && userContact.contactName) {\n      return _objectSpread(_objectSpread({}, user), {}, {\n        contactName: userContact.contactName\n      });\n    }\n\n    return user;\n  }\n\n  return React.createElement(View, {\n    style: {\n      flex: 1,\n      padding: 5,\n      paddingRight: 10\n    }\n  }, rooms.map(function (room) {\n    return React.createElement(ListItem, {\n      type: \"chat\",\n      description: room.lastMessage.text,\n      key: room.id,\n      room: room,\n      time: room.lastMessage.createAt,\n      user: getUserB(room.userB, contacts)\n    });\n  }), React.createElement(Text, null, \"Chats\"), React.createElement(ContactsFloatingIcons, null));\n}","map":{"version":3,"names":["collection","doc","onSnapshot","query","QuerySnapshot","where","React","useContext","useEffect","auth","db","GlobalContext","ContactsFloatingIcons","ListItem","useContacts","Chats","currentUser","rooms","setRooms","setUnfilteredRooms","contacts","chatsQuery","email","unsubscribe","parsedChats","docs","map","data","id","userB","participants","find","p","filter","lastMessage","getUserB","user","userContact","c","contactName","flex","padding","paddingRight","room","text","createAt"],"sources":["C:/Users/johan/OneDrive/Bureau/Appmobile/Secretly/wp-clone-starter/screens/Chats.js"],"sourcesContent":["import {\r\n  collection,\r\n  doc,\r\n  onSnapshot,\r\n  query,\r\n  QuerySnapshot,\r\n  where,\r\n} from \"@firebase/firestore\";\r\nimport { View, Text } from \"react-native\";\r\nimport React, { useContext, useEffect } from \"react\";\r\nimport { auth, db } from \"../firebase\";\r\nimport GlobalContext from \"../context/Context\";\r\nimport ContactsFloatingIcons from \"../components/ContactsFloatingIcons\";\r\nimport ListItem from \"../components/ListItem\";\r\nimport useContacts from \"../hooks/useHooks\";\r\n\r\nexport default function Chats() {\r\n  const { currentUser } = auth;\r\n  const { rooms, setRooms, setUnfilteredRooms } = useContext(GlobalContext);\r\n  const contacts = useContacts();\r\n\r\n  const chatsQuery = query(\r\n    collection(db, \"rooms\"),\r\n    where(\"participantsArray\", \"array-contains\", currentUser.email)\r\n  );\r\n\r\n  //use effect\r\n  useEffect(() => {\r\n    const unsubscribe = onSnapshot(chatsQuery, (QuerySnapshot) => {\r\n      const parsedChats = QuerySnapshot.docs.map((doc) => ({\r\n        ...doc.data(),\r\n        id: doc.id,\r\n        userB: doc\r\n          .data()\r\n          .participants.find((p) => p.email == !currentUser.email),\r\n      }));\r\n      setUnfilteredRooms(parsedChats);\r\n      setRooms(parsedChats.filter((doc) => doc.data().lastMessage));\r\n    });\r\n    return () => unsubscribe();\r\n  }, []);\r\n\r\n  function getUserB(user, contacts) {\r\n    const userContact = contacts.find((c) => c.email === user.email);\r\n    if (userContact && userContact.contactName) {\r\n      return { ...user, contactName: userContact.contactName };\r\n    }\r\n    return user;\r\n  }\r\n\r\n  return (\r\n    <View style={{ flex: 1, padding: 5, paddingRight: 10 }}>\r\n      {rooms.map((room) => (\r\n        <ListItem\r\n          type=\"chat\"\r\n          description={room.lastMessage.text}\r\n          key={room.id}\r\n          room={room}\r\n          time={room.lastMessage.createAt}\r\n          user={getUserB(room.userB, contacts)}\r\n        />\r\n      ))}\r\n      <Text>Chats</Text>\r\n      <ContactsFloatingIcons />\r\n    </View>\r\n  );\r\n}\r\n"],"mappings":";;;;;;AAAA,SACEA,UADF,EAEEC,GAFF,EAGEC,UAHF,EAIEC,KAJF,EAKEC,aALF,EAMEC,KANF,QAOO,qBAPP;;;AASA,OAAOC,KAAP,IAAgBC,UAAhB,EAA4BC,SAA5B,QAA6C,OAA7C;AACA,SAASC,IAAT,EAAeC,EAAf;AACA,OAAOC,aAAP;AACA,OAAOC,qBAAP;AACA,OAAOC,QAAP;AACA,OAAOC,WAAP;AAEA,eAAe,SAASC,KAAT,GAAiB;EAC9B,IAAQC,WAAR,GAAwBP,IAAxB,CAAQO,WAAR;;EACA,kBAAgDT,UAAU,CAACI,aAAD,CAA1D;EAAA,IAAQM,KAAR,eAAQA,KAAR;EAAA,IAAeC,QAAf,eAAeA,QAAf;EAAA,IAAyBC,kBAAzB,eAAyBA,kBAAzB;;EACA,IAAMC,QAAQ,GAAGN,WAAW,EAA5B;EAEA,IAAMO,UAAU,GAAGlB,KAAK,CACtBH,UAAU,CAACU,EAAD,EAAK,OAAL,CADY,EAEtBL,KAAK,CAAC,mBAAD,EAAsB,gBAAtB,EAAwCW,WAAW,CAACM,KAApD,CAFiB,CAAxB;EAMAd,SAAS,CAAC,YAAM;IACd,IAAMe,WAAW,GAAGrB,UAAU,CAACmB,UAAD,EAAa,UAACjB,aAAD,EAAmB;MAC5D,IAAMoB,WAAW,GAAGpB,aAAa,CAACqB,IAAd,CAAmBC,GAAnB,CAAuB,UAACzB,GAAD;QAAA,uCACtCA,GAAG,CAAC0B,IAAJ,EADsC;UAEzCC,EAAE,EAAE3B,GAAG,CAAC2B,EAFiC;UAGzCC,KAAK,EAAE5B,GAAG,CACP0B,IADI,GAEJG,YAFI,CAESC,IAFT,CAEc,UAACC,CAAD;YAAA,OAAOA,CAAC,CAACV,KAAF,IAAW,CAACN,WAAW,CAACM,KAA/B;UAAA,CAFd;QAHkC;MAAA,CAAvB,CAApB;MAOAH,kBAAkB,CAACK,WAAD,CAAlB;MACAN,QAAQ,CAACM,WAAW,CAACS,MAAZ,CAAmB,UAAChC,GAAD;QAAA,OAASA,GAAG,CAAC0B,IAAJ,GAAWO,WAApB;MAAA,CAAnB,CAAD,CAAR;IACD,CAV6B,CAA9B;IAWA,OAAO;MAAA,OAAMX,WAAW,EAAjB;IAAA,CAAP;EACD,CAbQ,EAaN,EAbM,CAAT;;EAeA,SAASY,QAAT,CAAkBC,IAAlB,EAAwBhB,QAAxB,EAAkC;IAChC,IAAMiB,WAAW,GAAGjB,QAAQ,CAACW,IAAT,CAAc,UAACO,CAAD;MAAA,OAAOA,CAAC,CAAChB,KAAF,KAAYc,IAAI,CAACd,KAAxB;IAAA,CAAd,CAApB;;IACA,IAAIe,WAAW,IAAIA,WAAW,CAACE,WAA/B,EAA4C;MAC1C,uCAAYH,IAAZ;QAAkBG,WAAW,EAAEF,WAAW,CAACE;MAA3C;IACD;;IACD,OAAOH,IAAP;EACD;;EAED,OACE,oBAAC,IAAD;IAAM,KAAK,EAAE;MAAEI,IAAI,EAAE,CAAR;MAAWC,OAAO,EAAE,CAApB;MAAuBC,YAAY,EAAE;IAArC;EAAb,GACGzB,KAAK,CAACS,GAAN,CAAU,UAACiB,IAAD;IAAA,OACT,oBAAC,QAAD;MACE,IAAI,EAAC,MADP;MAEE,WAAW,EAAEA,IAAI,CAACT,WAAL,CAAiBU,IAFhC;MAGE,GAAG,EAAED,IAAI,CAACf,EAHZ;MAIE,IAAI,EAAEe,IAJR;MAKE,IAAI,EAAEA,IAAI,CAACT,WAAL,CAAiBW,QALzB;MAME,IAAI,EAAEV,QAAQ,CAACQ,IAAI,CAACd,KAAN,EAAaT,QAAb;IANhB,EADS;EAAA,CAAV,CADH,EAWE,oBAAC,IAAD,gBAXF,EAYE,oBAAC,qBAAD,OAZF,CADF;AAgBD"},"metadata":{},"sourceType":"module"}