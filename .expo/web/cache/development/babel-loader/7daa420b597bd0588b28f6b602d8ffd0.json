{"ast":null,"code":"import _defineProperty from \"@babel/runtime/helpers/defineProperty\";\n\nfunction ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); enumerableOnly && (symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; })), keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = null != arguments[i] ? arguments[i] : {}; i % 2 ? ownKeys(Object(source), !0).forEach(function (key) { _defineProperty(target, key, source[key]); }) : Object.getOwnPropertyDescriptors ? Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)) : ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } return target; }\n\nimport { collection, onSnapshot, query, where } from \"@firebase/firestore\";\nimport React, { useContext, useEffect } from \"react\";\nimport View from \"react-native-web/dist/exports/View\";\nimport Text from \"react-native-web/dist/exports/Text\";\nimport GlobalContext from \"../context/Context\";\nimport { auth, db } from \"../firebase\";\nimport ContactsFloatingIcon from \"../components/ContactsFloatingIcons\";\nimport ListItem from \"../components/ListItem\";\nimport useContacts from \"../hooks/useHooks\";\nexport default function Chats() {\n  var currentUser = auth.currentUser;\n\n  var _useContext = useContext(GlobalContext),\n      rooms = _useContext.rooms,\n      setRooms = _useContext.setRooms,\n      setUnfilteredRooms = _useContext.setUnfilteredRooms;\n\n  var contacts = useContacts();\n  var chatsQuery = query(collection(db, \"rooms\"), where(\"participantsArray\", \"array-contains\", currentUser.email));\n  useEffect(function () {\n    var unsubscribe = onSnapshot(chatsQuery, function (querySnapshot) {\n      var parsedChats = querySnapshot.docs.map(function (doc) {\n        return _objectSpread(_objectSpread({}, doc.data()), {}, {\n          id: doc.id,\n          userB: doc.data().participants.find(function (p) {\n            return p.email !== currentUser.email;\n          })\n        });\n      });\n      setUnfilteredRooms(parsedChats);\n      setRooms(parsedChats.filter(function (doc) {\n        return doc.lastMessage;\n      }));\n    });\n    return function () {\n      return unsubscribe();\n    };\n  }, []);\n\n  function getUserB(user, contacts) {\n    var userContact = contacts.find(function (c) {\n      return c.email === user.email;\n    });\n\n    if (userContact && userContact.contactName) {\n      return _objectSpread(_objectSpread({}, user), {}, {\n        contactName: userContact.contactName\n      });\n    }\n\n    return user;\n  }\n\n  return React.createElement(View, {\n    style: {\n      flex: 1,\n      padding: 5,\n      paddingRight: 10\n    }\n  }, rooms.map(function (room) {\n    return React.createElement(ListItem, {\n      type: \"chat\",\n      description: room.lastMessage.text,\n      key: room.id,\n      room: room,\n      time: room.lastMessage.createdAt,\n      user: getUserB(room.userB, contacts)\n    });\n  }), React.createElement(ContactsFloatingIcon, null));\n}","map":{"version":3,"names":["collection","onSnapshot","query","where","React","useContext","useEffect","GlobalContext","auth","db","ContactsFloatingIcon","ListItem","useContacts","Chats","currentUser","rooms","setRooms","setUnfilteredRooms","contacts","chatsQuery","email","unsubscribe","querySnapshot","parsedChats","docs","map","doc","data","id","userB","participants","find","p","filter","lastMessage","getUserB","user","userContact","c","contactName","flex","padding","paddingRight","room","text","createdAt"],"sources":["C:/Users/johan/OneDrive/Bureau/Appmobile/Secretly/wp-clone-starter/screens/Chats.js"],"sourcesContent":["import { collection, onSnapshot, query, where } from \"@firebase/firestore\";\r\nimport React, { useContext, useEffect } from \"react\";\r\nimport { View, Text } from \"react-native\";\r\nimport GlobalContext from \"../context/Context\";\r\nimport { auth, db } from \"../firebase\";\r\nimport ContactsFloatingIcon from \"../components/ContactsFloatingIcons\";\r\nimport ListItem from \"../components/ListItem\";\r\nimport useContacts from \"../hooks/useHooks\";\r\nexport default function Chats() {\r\n  const { currentUser } = auth;\r\n  const { rooms, setRooms, setUnfilteredRooms } = useContext(GlobalContext);\r\n  const contacts = useContacts();\r\n  const chatsQuery = query(\r\n    collection(db, \"rooms\"),\r\n    where(\"participantsArray\", \"array-contains\", currentUser.email)\r\n  );\r\n  useEffect(() => {\r\n    const unsubscribe = onSnapshot(chatsQuery, (querySnapshot) => {\r\n      const parsedChats = querySnapshot.docs.map((doc) => ({\r\n        ...doc.data(),\r\n        id: doc.id,\r\n        userB: doc\r\n          .data()\r\n          .participants.find((p) => p.email !== currentUser.email),\r\n      }));\r\n      setUnfilteredRooms(parsedChats);\r\n      setRooms(parsedChats.filter((doc) => doc.lastMessage));\r\n    });\r\n    return () => unsubscribe();\r\n  }, []);\r\n\r\n  function getUserB(user, contacts) {\r\n    const userContact = contacts.find((c) => c.email === user.email);\r\n    if (userContact && userContact.contactName) {\r\n      return { ...user, contactName: userContact.contactName };\r\n    }\r\n    return user;\r\n  }\r\n\r\n  return (\r\n    <View style={{ flex: 1, padding: 5, paddingRight: 10 }}>\r\n      {rooms.map((room) => (\r\n        <ListItem\r\n          type=\"chat\"\r\n          description={room.lastMessage.text}\r\n          key={room.id}\r\n          room={room}\r\n          time={room.lastMessage.createdAt}\r\n          user={getUserB(room.userB, contacts)}\r\n        />\r\n      ))}\r\n      <ContactsFloatingIcon />\r\n    </View>\r\n  );\r\n}\r\n"],"mappings":";;;;;;AAAA,SAASA,UAAT,EAAqBC,UAArB,EAAiCC,KAAjC,EAAwCC,KAAxC,QAAqD,qBAArD;AACA,OAAOC,KAAP,IAAgBC,UAAhB,EAA4BC,SAA5B,QAA6C,OAA7C;;;AAEA,OAAOC,aAAP;AACA,SAASC,IAAT,EAAeC,EAAf;AACA,OAAOC,oBAAP;AACA,OAAOC,QAAP;AACA,OAAOC,WAAP;AACA,eAAe,SAASC,KAAT,GAAiB;EAC9B,IAAQC,WAAR,GAAwBN,IAAxB,CAAQM,WAAR;;EACA,kBAAgDT,UAAU,CAACE,aAAD,CAA1D;EAAA,IAAQQ,KAAR,eAAQA,KAAR;EAAA,IAAeC,QAAf,eAAeA,QAAf;EAAA,IAAyBC,kBAAzB,eAAyBA,kBAAzB;;EACA,IAAMC,QAAQ,GAAGN,WAAW,EAA5B;EACA,IAAMO,UAAU,GAAGjB,KAAK,CACtBF,UAAU,CAACS,EAAD,EAAK,OAAL,CADY,EAEtBN,KAAK,CAAC,mBAAD,EAAsB,gBAAtB,EAAwCW,WAAW,CAACM,KAApD,CAFiB,CAAxB;EAIAd,SAAS,CAAC,YAAM;IACd,IAAMe,WAAW,GAAGpB,UAAU,CAACkB,UAAD,EAAa,UAACG,aAAD,EAAmB;MAC5D,IAAMC,WAAW,GAAGD,aAAa,CAACE,IAAd,CAAmBC,GAAnB,CAAuB,UAACC,GAAD;QAAA,uCACtCA,GAAG,CAACC,IAAJ,EADsC;UAEzCC,EAAE,EAAEF,GAAG,CAACE,EAFiC;UAGzCC,KAAK,EAAEH,GAAG,CACPC,IADI,GAEJG,YAFI,CAESC,IAFT,CAEc,UAACC,CAAD;YAAA,OAAOA,CAAC,CAACZ,KAAF,KAAYN,WAAW,CAACM,KAA/B;UAAA,CAFd;QAHkC;MAAA,CAAvB,CAApB;MAOAH,kBAAkB,CAACM,WAAD,CAAlB;MACAP,QAAQ,CAACO,WAAW,CAACU,MAAZ,CAAmB,UAACP,GAAD;QAAA,OAASA,GAAG,CAACQ,WAAb;MAAA,CAAnB,CAAD,CAAR;IACD,CAV6B,CAA9B;IAWA,OAAO;MAAA,OAAMb,WAAW,EAAjB;IAAA,CAAP;EACD,CAbQ,EAaN,EAbM,CAAT;;EAeA,SAASc,QAAT,CAAkBC,IAAlB,EAAwBlB,QAAxB,EAAkC;IAChC,IAAMmB,WAAW,GAAGnB,QAAQ,CAACa,IAAT,CAAc,UAACO,CAAD;MAAA,OAAOA,CAAC,CAAClB,KAAF,KAAYgB,IAAI,CAAChB,KAAxB;IAAA,CAAd,CAApB;;IACA,IAAIiB,WAAW,IAAIA,WAAW,CAACE,WAA/B,EAA4C;MAC1C,uCAAYH,IAAZ;QAAkBG,WAAW,EAAEF,WAAW,CAACE;MAA3C;IACD;;IACD,OAAOH,IAAP;EACD;;EAED,OACE,oBAAC,IAAD;IAAM,KAAK,EAAE;MAAEI,IAAI,EAAE,CAAR;MAAWC,OAAO,EAAE,CAApB;MAAuBC,YAAY,EAAE;IAArC;EAAb,GACG3B,KAAK,CAACU,GAAN,CAAU,UAACkB,IAAD;IAAA,OACT,oBAAC,QAAD;MACE,IAAI,EAAC,MADP;MAEE,WAAW,EAAEA,IAAI,CAACT,WAAL,CAAiBU,IAFhC;MAGE,GAAG,EAAED,IAAI,CAACf,EAHZ;MAIE,IAAI,EAAEe,IAJR;MAKE,IAAI,EAAEA,IAAI,CAACT,WAAL,CAAiBW,SALzB;MAME,IAAI,EAAEV,QAAQ,CAACQ,IAAI,CAACd,KAAN,EAAaX,QAAb;IANhB,EADS;EAAA,CAAV,CADH,EAWE,oBAAC,oBAAD,OAXF,CADF;AAeD"},"metadata":{},"sourceType":"module"}